<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>QA Test Results</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 1rem 2rem;
      background-color: #f5f5f5;
      line-height: 1.5; /* Improve readability */
    }
    h1 {
      margin-bottom: 0.5rem;
      color: #333;
    }
    .summary {
      background-color: #fff;
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .summary p {
        margin: 0;
        font-size: 1.1em;
    }

    details {
      margin-bottom: 0.8rem;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.8rem 1rem; /* Slightly more padding */
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    summary {
      font-weight: bold;
      cursor: pointer;
      list-style: none; /* Remove default marker */
      outline: none;
      margin-bottom: 0.5rem; /* Space below summary when open */
      font-size: 1.05em;
    }
    summary::-webkit-details-marker { display: none; } /* Chrome/Safari */
    summary::marker { display: none; } /* Firefox */

    /* Add custom marker */
    summary::before {
        content: '► '; /* Collapsed state */
        font-size: 0.8em;
        margin-right: 5px;
    }
    details[open] > summary::before {
        content: '▼ '; /* Expanded state */
    }

    .explanation, .prompt { /* Apply similar styling to both */
      margin: 0.5rem 0;
      padding: 0.8rem;
      background-color: #eee;
      border-radius: 4px;
      border-left: 4px solid #aaa; /* Add a visual bar */
      word-wrap: break-word; /* Prevent long prompts from overflowing */
    }
    .prompt {
        background-color: #eaf2fa; /* Slightly different background for prompt */
        border-left-color: #7aade9;
    }

    .artifacts {
      margin: 1rem 0 0.5rem 0; /* Add margin top */
      padding-top: 0.5rem;
      border-top: 1px dashed #ddd; /* Separator */
    }
    .artifacts h4 {
        margin-top: 0;
        margin-bottom: 0.5rem;
        color: #555;
    }
    .artifact-link {
      display: inline-block;
      margin-right: 1rem;
      margin-bottom: 0.5rem; /* Space below links */
      color: #0366d6;
      text-decoration: none;
    }
    .artifact-link:hover {
        text-decoration: underline;
    }
    .screenshots {
      display: flex;
      gap: 1.5rem; /* Slightly smaller gap */
      flex-wrap: wrap;
      margin-top: 0.8rem;
    }
    .screenshots div { /* Container for each screenshot type */
        flex: 1 1 200px; /* Allow wrapping */
        min-width: 150px;
    }
    .screenshots p { /* Label for screenshots */
        margin: 0 0 0.5rem 0;
        font-weight: bold;
        color: #444;
    }
    .screenshots img {
      max-width: 200px;
      height: auto; /* Maintain aspect ratio */
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      transition: transform 0.2s ease-in-out;
      display: block; /* Prevent extra space below image */
    }
    .screenshots img:hover {
        transform: scale(1.05);
        border-color: #888;
    }
  </style>
</head>
<body>

<h1>QA Test Results</h1>
<div class="summary">
  <p><strong>Passed:</strong> {{ passed_count }} &nbsp;&nbsp;
     <strong>Failed:</strong> {{ failed_count }} &nbsp;&nbsp;
     <strong>Skipped:</strong> {{ skipped_count }}
  </p>
</div>

{% for test in tests %}
  {% set bgColor = "" %}
  {% if test.status == "pass" %}
    {% set bgColor = "#e6ffed" %} {# Lighter green #}
  {% elif test.status == "fail" %}
    {% set bgColor = "#ffebee" %} {# Lighter red #}
  {% elif test.status == "skipped" %}
    {% set bgColor = "#f5f5f5" %} {# Lighter grey #}
  {% else %}
    {% set bgColor = "#fff" %}
  {% endif %}

  <details style="background-color: {{ bgColor }};">
    {# Display test name and status in the summary #}
    <summary>{{ test.name }} &mdash; {{ test.status|upper if test.status else 'UNKNOWN' }}</summary>

    {# Display Explanation #}
    <div class="explanation">
      <strong>Explanation:</strong> {{ test.explanation if test.explanation else 'N/A' }}
    </div>

    {# <<< Display Original Prompt if available >>> #}
    {% if test.prompt %}
    <div class="prompt">
      <strong>Original Prompt:</strong> {{ test.prompt }}
    </div>
    {% endif %}

    {# Display Artifacts #}
    <div class="artifacts">
      <h4>Artifacts</h4>
      {% if test.text_files %}
        <p>Text File(s):
          {% for txt in test.text_files %}
            {# Link points to artifacts/<filename> relative to index.html #}
            <a class="artifact-link" href="artifacts/{{txt}}" download>{{txt}}</a>
          {% endfor %}
        </p>
      {% endif %}

      {# Display Screenshots #}
      <div class="screenshots">
        {% if test.screenshots_prod %}
          <div>
            <p>Production:</p>
            {% for img in test.screenshots_prod %}
              <a href="artifacts/{{img}}" target="_blank" title="View Production Screenshot: {{img}}">
                <img src="artifacts/{{img}}" alt="Production screenshot: {{img}}" />
              </a>
            {% endfor %}
          </div>
        {% endif %}
        {% if test.screenshots_target %}
          <div>
            <p>Target:</p>
            {% for img in test.screenshots_target %}
              <a href="artifacts/{{img}}" target="_blank" title="View Preview Screenshot: {{img}}">
                <img src="artifacts/{{img}}" alt="Preview screenshot: {{img}}" />
              </a>
            {% endfor %}
          </div>
        {% endif %}
        {% if test.screenshots_single %}
          <div>
            <p>Single:</p> {# Changed label for clarity #}
            {% for img in test.screenshots_single %}
              <a href="artifacts/{{img}}" target="_blank" title="View Screenshot: {{img}}">
                <img src="artifacts/{{img}}" alt="Single screenshot: {{img}}" />
              </a>
            {% endfor %}
          </div>
        {% endif %}
        {# Add section for failure screenshots if implemented #}
        {# {% if test.screenshots_failure %} ... {% endif %} #}
      </div>
      {# Show message if no artifacts found for this test #}
      {% if not test.text_files and not test.screenshots_prod and not test.screenshots_target and not test.screenshots_single %}
        <p><em>No artifacts generated for this test.</em></p>
      {% endif %}
    </div> {# End artifacts div #}
  </details>
{% endfor %}

</body>
</html>